import { TypeList } from "docs-ui"

# TransactionStepHandler

 **TransactionStepHandler**: (`actionId`: `string`, `handlerType`: [TransactionHandlerType](../../enums/workflows.TransactionHandlerType/page.mdx), `payload`: [TransactionPayload](../../classes/workflows.TransactionPayload/page.mdx), `transaction`: [DistributedTransaction](../../classes/workflows.DistributedTransaction/page.mdx), `step`: [TransactionStep](../../classes/workflows.TransactionStep/page.mdx), `orchestrator`: [TransactionOrchestrator](../../classes/workflows.TransactionOrchestrator/page.mdx)) => Promise&#60;unknown&#62;

## Parameters

<TypeList types={[{"name":"actionId","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"handlerType","type":"[TransactionHandlerType](../../enums/workflows.TransactionHandlerType/page.mdx)","description":"","optional":false,"defaultValue":"","expandable":false,"children":[{"name":"INVOKE","type":"`\"invoke\"`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]},{"name":"COMPENSATE","type":"`\"compensate\"`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]}]},{"name":"payload","type":"[TransactionPayload](../../classes/workflows.TransactionPayload/page.mdx)","description":"","optional":false,"defaultValue":"","expandable":false,"children":[{"name":"metadata","type":"[TransactionMetadata](../workflows.TransactionMetadata/page.mdx)","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"data","type":"`Record<string, unknown>`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"context","type":"[TransactionContext](../../classes/workflows.TransactionContext/page.mdx)","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]}]},{"name":"transaction","type":"[DistributedTransaction](../../classes/workflows.DistributedTransaction/page.mdx)","description":"","optional":false,"defaultValue":"","expandable":false,"children":[{"name":"#private","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"flow","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"handler","type":"[TransactionStepHandler](./page.mdx)","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"modelId","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"transactionId","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"runId","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"errors","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"context","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"keyValueStore","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"keyPrefix","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"payload","type":"`any`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]}]},{"name":"step","type":"[TransactionStep](../../classes/workflows.TransactionStep/page.mdx)","description":"TransactionStep","optional":false,"defaultValue":"","expandable":false,"children":[{"name":"stepFailed","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"id","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"depth","type":"`number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"definition","type":"[TransactionStepsDefinition](../workflows.TransactionStepsDefinition/page.mdx)","description":"Defines the structure and behavior of a single step within a transaction workflow.","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"invoke","type":"`object`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"compensate","type":"`object`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"attempts","type":"`number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"failures","type":"`number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"temporaryFailedAt","type":"`null` \\| `number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"lastAttempt","type":"`null` \\| `number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"retryRescheduledAt","type":"`null` \\| `number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"hasScheduledRetry","type":"`boolean`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"timedOutAt","type":"`null` \\| `number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"next","type":"`string`[]","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"saveResponse","type":"`boolean`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"uuid","type":"`string`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]},{"name":"startedAt","type":"`number`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]},{"name":"_v","type":"`number`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]}]},{"name":"orchestrator","type":"[TransactionOrchestrator](../../classes/workflows.TransactionOrchestrator/page.mdx)","description":"TransactionOrchestrator is responsible for managing and executing distributed transactions.\nIt is based on a single transaction definition, which is used to execute all the transaction steps","optional":false,"defaultValue":"","expandable":false,"children":[{"name":"id","type":"`string`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"ROOT_STEP","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"DEFAULT_TTL","type":"`number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"invokeSteps","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"compensateSteps","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"definition","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"DEFAULT_RETRIES","type":"`number`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"workflowOptions","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"SEPARATOR","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"getPreviousStep","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"getInvokeSteps","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"getCompensationSteps","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"countSiblings","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"canMoveForward","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"canMoveBackward","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"canContinue","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"hasExpired","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"checkTransactionTimeout","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"checkStepTimeout","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"checkAllSteps","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"computeCurrentTransactionState","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"flagStepsToRevert","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"setStepSuccess","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"retryStep","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"skipStep","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"setStepTimeout","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"setStepFailure","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"executeNext","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"finalizeTransaction","type":"`any`","description":"Finalize the transaction when all steps are complete","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"prepareStepForExecution","type":"`any`","description":"Prepare a step for execution by setting state and incrementing attempts","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"createStepPayload","type":"`any`","description":"Create the payload for a step execution","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"prepareHandlerArgs","type":"`any`","description":"Prepare handler arguments for step execution","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"createStepExecutionPromise","type":"`any`","description":"Create the step execution promise with optional tracing","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"executeSyncStep","type":"`any`","description":"Execute a synchronous step and handle its result","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"executeAsyncStep","type":"`any`","description":"Execute an asynchronous step and handle its result","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"handleStepExpiration","type":"`any`","description":"Check if step or transaction has expired and handle timeouts","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"handleStepSuccess","type":"`any`","description":"Handle successful step completion","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"handleStepFailure","type":"`any`","description":"Handle step failure","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"parseFlowOptions","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"createTransactionFlow","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"loadTransactionById","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"getStepByAction","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"getTransactionAndStepFromIdempotencyKey","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"options","type":"`any`","description":"","optional":true,"defaultValue":"","expandable":false,"children":[]},{"name":"traceTransaction","type":"(`transactionResume`: (...`args`: `any`[]) => Promise&#60;void&#62;, `metadata`: ``{ model_id: string ; transaction_id: string ; flow_metadata: undefined \\| &#123; [key: string]: unknown; eventGroupId?: string ; parentIdempotencyKey?: string ; cancelingFromParentStep?: boolean ; sourcePath?: string ; preventReleaseEvents?: boolean ; parentStepIdempotencyKey?: string  &#125;  }``) => Promise&#60;any&#62;","description":"Trace workflow transaction for instrumentation","optional":true,"defaultValue":"","expandable":false,"children":[]},{"name":"traceStep","type":"(`handler`: (...`args`: `any`[]) => Promise&#60;any&#62;, `metadata`: ``{ action: string ; type: \"invoke\" \\| \"compensate\" ; step_id: string ; step_uuid: string ; attempts: number ; failures: number ; async: boolean ; idempotency_key: string  }``) => Promise&#60;any&#62;","description":"Trace workflow steps for instrumentation","optional":true,"defaultValue":"","expandable":false,"children":[]}]}]} expandUrl="https://docs.medusajs.com/learn/fundamentals/data-models/manage-relationships#retrieve-records-of-relation" sectionTitle="__type"/>

## Returns

<TypeList types={[{"name":"Promise","type":"Promise&#60;unknown&#62;","optional":false,"defaultValue":"","description":"","expandable":false,"children":[{"name":"unknown","type":"`unknown`","optional":false,"defaultValue":"","description":"","expandable":false,"children":[]}]}]} expandUrl="https://docs.medusajs.com/learn/fundamentals/data-models/manage-relationships#retrieve-records-of-relation" sectionTitle="__type"/>
