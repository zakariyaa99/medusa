---
slug: /references/medusa-workflows/listShippingOptionsForCartWithPricingWorkflow
sidebar_label: listShippingOptionsForCartWithPricingWorkflow
sidebar_description: List a cart's shipping options with prices.
tags:
  - fulfillment
  - workflow
---

import { TypeList, WorkflowDiagram } from "docs-ui"

# listShippingOptionsForCartWithPricingWorkflow - Medusa Core Workflows Reference

This documentation provides a reference to the `listShippingOptionsForCartWithPricingWorkflow`. It belongs to the `@medusajs/medusa/core-flows` package.

This workflow lists shipping options that can be used during checkout for a cart. It also retrieves the prices
of these shipping options, including calculated prices that may be retrieved from third-party providers.

This workflow is executed in other cart-related workflows, such as [addShippingMethodToCartWorkflow](../core_flows.Cart.Workflows_Cart.addShippingMethodToCartWorkflow/page.mdx) to retrieve the
price of the shipping method being added to the cart.

You can use this workflow within your own customizations or custom workflows, allowing you to retrieve the shipping options of a cart and their prices
in your custom flows.

<SourceCodeLink link="https://github.com/medusajs/medusa/blob/a960fb75c9f662372fd5cd623f883f9d6d8ad473/packages/core/core-flows/src/cart/workflows/list-shipping-options-for-cart-with-pricing.ts#L127" />

## Examples

<CodeTabs group="workflow-exection">
    <CodeTab label="API Route" value="api-route">
    
```ts title="src/api/workflow/route.ts"
import type {
  MedusaRequest,
  MedusaResponse,
} from "@medusajs/framework/http"
import { listShippingOptionsForCartWithPricingWorkflow } from "@medusajs/medusa/core-flows"

export async function POST(
  req: MedusaRequest,
  res: MedusaResponse
) {
  const { result } = await listShippingOptionsForCartWithPricingWorkflow(req
      .scope)
    .run({
      input: {
        cart_id: "cart_123",
        options: [{
          id: "so_123",
          data: {
            carrier_code: "fedex"
          }
        }]
      }
    })

  res.send(result)
}
```

    </CodeTab>
    <CodeTab label="Subscriber" value="subscriber">
    
```ts title="src/subscribers/order-placed.ts"
import {
  type SubscriberConfig,
  type SubscriberArgs,
} from "@medusajs/framework"
import { listShippingOptionsForCartWithPricingWorkflow } from "@medusajs/medusa/core-flows"

export default async function handleOrderPlaced({
  event: { data },
  container,
}: SubscriberArgs < { id: string } > ) {
  const { result } = await listShippingOptionsForCartWithPricingWorkflow(
      container)
    .run({
      input: {
        cart_id: "cart_123",
        options: [{
          id: "so_123",
          data: {
            carrier_code: "fedex"
          }
        }]
      }
    })

  console.log(result)
}

export const config: SubscriberConfig = {
  event: "order.placed",
}
```

    </CodeTab>
    <CodeTab label="Scheduled Job" value="scheduled-job">
    
```ts title="src/jobs/message-daily.ts"
import { MedusaContainer } from "@medusajs/framework/types"
import { listShippingOptionsForCartWithPricingWorkflow } from "@medusajs/medusa/core-flows"

export default async function myCustomJob(
  container: MedusaContainer
) {
  const { result } = await listShippingOptionsForCartWithPricingWorkflow(
      container)
    .run({
      input: {
        cart_id: "cart_123",
        options: [{
          id: "so_123",
          data: {
            carrier_code: "fedex"
          }
        }]
      }
    })

  console.log(result)
}

export const config = {
  name: "run-once-a-day",
  schedule: "0 0 * * *",
}
```

    </CodeTab>
    <CodeTab label="Another Workflow" value="another-workflow">
    
```ts title="src/workflows/my-workflow.ts"
import { createWorkflow } from "@medusajs/framework/workflows-sdk"
import { listShippingOptionsForCartWithPricingWorkflow } from "@medusajs/medusa/core-flows"

const myWorkflow = createWorkflow(
  "my-workflow",
  () => {
    const result = listShippingOptionsForCartWithPricingWorkflow
      .runAsStep({
        input: {
          cart_id: "cart_123",
          options: [{
            id: "so_123",
            data: {
              carrier_code: "fedex"
            }
          }]
        }
      })
  }
)
```

    </CodeTab>
  </CodeTabs>

## Steps

<WorkflowDiagram workflow={{"name":"listShippingOptionsForCartWithPricingWorkflow","steps":[{"type":"step","name":"validatePresenceOfStep","description":"This step validates the presence of attributes on an object","link":"../../../../Common/Steps_Common/functions/core_flows.Common.Steps_Common.validatePresenceOfStep/page.mdx","depth":1},{"type":"hook","name":"setShippingOptionsContext","description":"This hook is executed after the cart is retrieved and before the shipping options are queried. You can consume this hook to return any custom context useful for the shipping options retrieval.\n\nFor example, you can consume the hook to add the customer Id to the context:\n\n```ts\nimport { listShippingOptionsForCartWithPricingWorkflow } from \"@medusajs/medusa/core-flows\"\nimport { StepResponse } from \"@medusajs/workflows-sdk\"\n\nlistShippingOptionsForCartWithPricingWorkflow.hooks.setShippingOptionsContext(\n  async ({ cart }, { container }) => {\n\n    if (cart.customer_id) {\n      return new StepResponse({\n        customer_id: cart.customer_id,\n      })\n    }\n\n    const query = container.resolve(\"query\")\n\n    const { data: carts } = await query.graph({\n      entity: \"cart\",\n      filters: {\n        id: cart.id,\n      },\n      fields: [\"customer_id\"],\n    })\n\n    return new StepResponse({\n      customer_id: carts[0].customer_id,\n    })\n  }\n)\n```\n\nThe `customer_id` property will be added to the context along with other properties such as `is_return` and `enabled_in_store`.\n\n:::note\n\nYou should also consume the `setShippingOptionsContext` hook in the listShippingOptionsForCartWorkflow workflow to ensure that the context is consistent when listing shipping options across workflows.\n\n:::","link":"#setShippingOptionsContext","depth":2},{"type":"step","name":"calculateShippingOptionsPricesStep","description":"This step calculates the prices for one or more shipping options.","link":"../../../../Fulfillment/Steps_Fulfillment/functions/core_flows.Fulfillment.Steps_Fulfillment.calculateShippingOptionsPricesStep/page.mdx","depth":3},{"type":"step","name":"getTranslatedShippingOptionsStep","description":"This step applies translations to a list of shipping options based on the provided locale.\nIt modifies the shipping options in place and returns them.","link":"../../../../Common/Steps_Common/functions/core_flows.Common.Steps_Common.getTranslatedShippingOptionsStep/page.mdx","depth":4}]}} />

## Input

<TypeList types={[{"name":"ListShippingOptionsForCartWithPricingWorkflowInput & AdditionalData","type":"[ListShippingOptionsForCartWithPricingWorkflowInput](../../../../../types/types/types.ListShippingOptionsForCartWithPricingWorkflowInput/page.mdx) & [AdditionalData](../../../../../types/HttpTypes/types/types.HttpTypes.AdditionalData/page.mdx)","optional":false,"defaultValue":"","description":"","expandable":false,"children":[{"name":"ListShippingOptionsForCartWithPricingWorkflowInput","type":"[ListShippingOptionsForCartWithPricingWorkflowInput](../../../../../types/types/types.ListShippingOptionsForCartWithPricingWorkflowInput/page.mdx)","optional":false,"defaultValue":"","description":"The context for retrieving the shipping options.","expandable":false,"children":[{"name":"cart_id","type":"`string`","description":"The cart's ID.","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"options","type":"`object`[]","description":"Specify the shipping options to retrieve their details and prices.\nIf not provided, all applicable shipping options are retrieved.","optional":true,"defaultValue":"","expandable":false,"children":[{"name":"id","type":"`string`","description":"The shipping option's ID.","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"data","type":"`Record<string, unknown>`","description":"Custom data relevant for the fulfillment provider that processes this shipping option.\nIt can be data relevant to calculate the shipping option's price.\n\nLearn more in [this documentation](https://docs.medusajs.com/resources/commerce-modules/fulfillment/shipping-option#data-property).","optional":true,"defaultValue":"","expandable":false,"children":[]}]},{"name":"is_return","type":"`boolean`","description":"Whether to retrieve return shipping options.\nBy default, non-return shipping options are retrieved.","optional":true,"defaultValue":"false","expandable":false,"children":[]},{"name":"enabled_in_store","type":"`boolean`","description":"Whether to retrieve the shipping option's enabled in the store, which is the default.","optional":true,"defaultValue":"true","expandable":false,"children":[]}]},{"name":"AdditionalData","type":"[AdditionalData](../../../../../types/HttpTypes/types/types.HttpTypes.AdditionalData/page.mdx)","optional":false,"defaultValue":"","description":"","expandable":false,"children":[{"name":"additional_data","type":"`Record<string, unknown>`","description":"Additional data that can be passed through the `additional_data` property in HTTP requests.\n\nLearn more in [this documentation](https://docs.medusajs.com/learn/fundamentals/api-routes/additional-data).","optional":true,"defaultValue":"","expandable":false,"children":[]}]}]}]} expandUrl="https://docs.medusajs.com/learn/fundamentals/data-models/manage-relationships#retrieve-records-of-relation" openedLevel={1} sectionTitle="listShippingOptionsForCartWithPricingWorkflow"/>

## Output

<TypeList types={[{"name":"any[]","type":"`any`[]","optional":false,"defaultValue":"","description":"","expandable":false,"children":[{"name":"any","type":"`any`","optional":false,"defaultValue":"","description":"","expandable":false,"children":[]}]}]} expandUrl="https://docs.medusajs.com/learn/fundamentals/data-models/manage-relationships#retrieve-records-of-relation" openedLevel={1} sectionTitle="listShippingOptionsForCartWithPricingWorkflow"/>

## Hooks

Hooks allow you to inject custom functionalities into the workflow. You'll receive data from the workflow, as well as additional data sent through an HTTP request.

Learn more about [Hooks](https://docs.medusajs.com/learn/fundamentals/workflows/workflow-hooks) and [Additional Data](https://docs.medusajs.com/learn/fundamentals/api-routes/additional-data).

### setShippingOptionsContext

This hook is executed after the cart is retrieved and before the shipping options are queried. You can consume this hook to return any custom context useful for the shipping options retrieval.

For example, you can consume the hook to add the customer Id to the context:

```ts
import { listShippingOptionsForCartWithPricingWorkflow } from "@medusajs/medusa/core-flows"
import { StepResponse } from "@medusajs/workflows-sdk"

listShippingOptionsForCartWithPricingWorkflow.hooks.setShippingOptionsContext(
  async ({ cart }, { container }) => {

    if (cart.customer_id) {
      return new StepResponse({
        customer_id: cart.customer_id,
      })
    }

    const query = container.resolve("query")

    const { data: carts } = await query.graph({
      entity: "cart",
      filters: {
        id: cart.id,
      },
      fields: ["customer_id"],
    })

    return new StepResponse({
      customer_id: carts[0].customer_id,
    })
  }
)
```

The `customer_id` property will be added to the context along with other properties such as `is_return` and `enabled_in_store`.

:::note

You should also consume the `setShippingOptionsContext` hook in the [listShippingOptionsForCartWorkflow](../core_flows.Cart.Workflows_Cart.listShippingOptionsForCartWorkflow/page.mdx) workflow to ensure that the context is consistent when listing shipping options across workflows.

:::

#### Example

```ts
import { listShippingOptionsForCartWithPricingWorkflow } from "@medusajs/medusa/core-flows"

listShippingOptionsForCartWithPricingWorkflow.hooks.setShippingOptionsContext(
  (async ({ cart, fulfillmentSetIds, additional_data }, { container }) => {
    //TODO
  })
)
```

#### Input

Handlers consuming this hook accept the following input.

<TypeList types={[{"name":"input","type":"[input](../../../core_flows.Cart.Workflows_Cart/page.mdx#__type-7)","description":"The input data for the hook.","optional":false,"defaultValue":"","expandable":false,"children":[{"name":"cart","type":"`any`","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"fulfillmentSetIds","type":"`string`[]","description":"","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"additional_data","type":"`Record<string, unknown> | undefined`","description":"Additional data that can be passed through the `additional_data` property in HTTP requests.\nLearn more in [this documentation](https://docs.medusajs.com/learn/fundamentals/api-routes/additional-data).","optional":false,"defaultValue":"","expandable":false,"children":[]}]}]} expandUrl="https://docs.medusajs.com/learn/fundamentals/data-models/manage-relationships#retrieve-records-of-relation" openedLevel={1} sectionTitle="setShippingOptionsContext"/>
