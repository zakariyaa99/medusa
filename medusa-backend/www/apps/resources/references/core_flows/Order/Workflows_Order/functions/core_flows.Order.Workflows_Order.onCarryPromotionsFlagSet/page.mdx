---
slug: /references/medusa-workflows/onCarryPromotionsFlagSet
sidebar_label: onCarryPromotionsFlagSet
sidebar_description: Toggle carrying over promotions to outbound exchange items.
tags:
  - workflow
  - order
  - promotion
  - query
---

import { TypeList, WorkflowDiagram } from "docs-ui"

# onCarryPromotionsFlagSet - Medusa Core Workflows Reference

This documentation provides a reference to the `onCarryPromotionsFlagSet`. It belongs to the `@medusajs/medusa/core-flows` package.

This workflow toggles whether promotions are carried over to outbound items of an exchange.
It validates that the order change is an exchange and that it's active. It also validates that the promotion allocation
is valid for carrying over promotions. Finally, it computes adjustments for the order change
and either applies or removes promotion adjustments based on whether promotions are to be carried over.

This workflow is used by other workflows, such as the [updateOrderChangeWorkflow](../core_flows.Order.Workflows_Order.updateOrderChangeWorkflow/page.mdx).

You can use this workflow within your customizations or your own custom workflows, allowing you to 
set the carry over promotions flag for an order change in your custom flows.

:::note

This is available starting from [Medusa v2.12.0](https://github.com/medusajs/medusa/releases/tag/v2.12.0).

:::

<SourceCodeLink link="https://github.com/medusajs/medusa/blob/a960fb75c9f662372fd5cd623f883f9d6d8ad473/packages/core/core-flows/src/order/workflows/on-carry-promotions-flag-set.ts#L168" />

## Examples

<CodeTabs group="workflow-exection">
    <CodeTab label="API Route" value="api-route">
    
```ts title="src/api/workflow/route.ts"
import type {
  MedusaRequest,
  MedusaResponse,
} from "@medusajs/framework/http"
import { onCarryPromotionsFlagSet } from "@medusajs/medusa/core-flows"

export async function POST(
  req: MedusaRequest,
  res: MedusaResponse
) {
  const { result } = await onCarryPromotionsFlagSet(req.scope)
    .run({
      input: {
        order_change_id: "orch_123",
        carry_over_promotions: true,
      }
    })

  res.send(result)
}
```

    </CodeTab>
    <CodeTab label="Subscriber" value="subscriber">
    
```ts title="src/subscribers/order-placed.ts"
import {
  type SubscriberConfig,
  type SubscriberArgs,
} from "@medusajs/framework"
import { onCarryPromotionsFlagSet } from "@medusajs/medusa/core-flows"

export default async function handleOrderPlaced({
  event: { data },
  container,
}: SubscriberArgs < { id: string } > ) {
  const { result } = await onCarryPromotionsFlagSet(container)
    .run({
      input: {
        order_change_id: "orch_123",
        carry_over_promotions: true,
      }
    })

  console.log(result)
}

export const config: SubscriberConfig = {
  event: "order.placed",
}
```

    </CodeTab>
    <CodeTab label="Scheduled Job" value="scheduled-job">
    
```ts title="src/jobs/message-daily.ts"
import { MedusaContainer } from "@medusajs/framework/types"
import { onCarryPromotionsFlagSet } from "@medusajs/medusa/core-flows"

export default async function myCustomJob(
  container: MedusaContainer
) {
  const { result } = await onCarryPromotionsFlagSet(container)
    .run({
      input: {
        order_change_id: "orch_123",
        carry_over_promotions: true,
      }
    })

  console.log(result)
}

export const config = {
  name: "run-once-a-day",
  schedule: "0 0 * * *",
}
```

    </CodeTab>
    <CodeTab label="Another Workflow" value="another-workflow">
    
```ts title="src/workflows/my-workflow.ts"
import { createWorkflow } from "@medusajs/framework/workflows-sdk"
import { onCarryPromotionsFlagSet } from "@medusajs/medusa/core-flows"

const myWorkflow = createWorkflow(
  "my-workflow",
  () => {
    const result = onCarryPromotionsFlagSet
      .runAsStep({
        input: {
          order_change_id: "orch_123",
          carry_over_promotions: true,
        }
      })
  }
)
```

    </CodeTab>
  </CodeTabs>

## Steps

<WorkflowDiagram workflow={{"name":"onCarryPromotionsFlagSet","steps":[{"type":"step","name":"validateCarryPromotionsFlagStep","description":"This step validates that the order change is an exchange and validates that\nthe promotion allocation is valid for carrying over promotions.\n\n:::note\n\nYou can retrieve details of the order and order change using [Query](https://docs.medusajs.com/learn/fundamentals/module-links/query),\nor [useQueryGraphStep](https://docs.medusajs.com/resources/references/medusa-workflows/steps/useQueryGraphStep).\n\n:::","link":"../core_flows.Order.Workflows_Order.validateCarryPromotionsFlagStep/page.mdx","depth":1},{"type":"workflow","name":"computeAdjustmentsForPreviewWorkflow","description":"Compute adjustments for an order edit, exchange, claim, or return.","link":"../core_flows.Order.Workflows_Order.computeAdjustmentsForPreviewWorkflow/page.mdx","depth":2}]}} />

## Input

<TypeList types={[{"name":"OnCarryPromotionsFlagSetWorkflowInput","type":"[OnCarryPromotionsFlagSetWorkflowInput](../../../../types/core_flows.OnCarryPromotionsFlagSetWorkflowInput/page.mdx)","optional":false,"defaultValue":"","description":"The data to set the carry over promotions flag for an order change.","expandable":false,"children":[{"name":"order_change_id","type":"`string`","description":"The order change's ID.","optional":false,"defaultValue":"","expandable":false,"children":[]},{"name":"carry_over_promotions","type":"`boolean`","description":"Whether to carry over promotions to outbound exchange items.","optional":false,"defaultValue":"","expandable":false,"children":[]}]}]} expandUrl="https://docs.medusajs.com/learn/fundamentals/data-models/manage-relationships#retrieve-records-of-relation" openedLevel={1} sectionTitle="onCarryPromotionsFlagSet"/>
